{% comment %}
    Either the chosen or unchosen div will be shown, depending on the presence
    of the 'blank' class on the container.

    Any element with the 'action-choose' class will open the page chooser modal
    when clicked.
{% endcomment %}

<div id="{{ attrs.id }}-chooser" class="chooser {% block chooser_class %}page-chooser{% endblock %} {% if not value %}blank{% endif %}" {% block chooser_attributes %}{% endblock %}>

    <div class="chosen">
        {% block chosen_state_view %}{% endblock %}

        <ul class="actions">
            {% if not widget.is_required and widget.show_clear_link %}
                <li><button type="button" class="button action-clear button-small button-secondary">{{ widget.clear_choice_text }}</button></li>
            {% endif %}
            <li><button type="button" class="button action-choose button-small button-secondary">{{ widget.choose_another_text }}</button></li>
            {% if widget.show_edit_link %}
                <li>
                    {% block edit_link %}
                        <a href="{% block edit_chosen_item_url %}#{% endblock %}" class="edit-link button button-small button-secondary" target="_blank" rel="noopener noreferrer">{{ widget.link_to_chosen_text }}</a>
                    {% endblock %}
                </li>
            {% endif %}
        </ul>
    </div>

    <div class="unchosen">
        <button type="button" class="button action-choose button-small button-secondary">{{ widget.choose_one_text }}</button>
    </div>

    {% load wagtailadmin_tags %}
    <div>
        <button type="button" id="{{ attrs.id }}-comments" class="button button-secondary button-small">{% icon name='comment' class_name='initial' %}</button>
    </div>

    <button type="button" id="comment-icon" class="annotation button-secondary button-small" hidden>{% icon name='comment' class_name='initial' %}</button>

    <script>
        document.querySelector('#{{ attrs.id }}-comments').addEventListener('click', (e) => {
            let btn = document.querySelector('#{{ attrs.id }}-comments')
            btn.hidden = true;
            btn.classList.remove('button');
            let testComment = document.querySelector('#comment-icon').cloneNode(deep=true)
            btn.insertAdjacentElement('afterend', testComment);
            let annotation = {
                position: 'test',
                onDelete: () => {
                    testComment.remove();
                    btn.classList.add('button');
                    btn.hidden = false;
                },
                onFocus: () => {testComment.classList.remove('button-secondary');},
                onUnfocus: () => {testComment.classList.add('button-secondary');},
                show: () => {
                    testComment.classList.add('button');
                    testComment.hidden = false;
                },
                hide: () => {
                    testComment.classList.remove('button')
                    testComment.hidden = true;
                },
                setOnClickHandler: (handler) => {
                    testComment.addEventListener('click', handler);
                },
                getDesiredPosition: () => {return (document.querySelector("#{{ attrs.id }}-chooser").getBoundingClientRect().top + document.documentElement.scrollTop); }
            }
            window.comments.app.makeComment(annotation, 'test_content_path');
        });
    </script>

</div>

{{ original_field_html }}
